{"ID":"20240929141449-zjw8o3z","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240929141449-zjw8o3z","title":"自动内存管理","type":"doc","updated":"20240929142657"},"Children":[{"ID":"20240929141449-cqulad9","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240929141449-cqulad9","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java内存区域与内存溢出异常"}]},{"ID":"20240929141632-ysqqd9u","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240929141632-ysqqd9u","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java内存区详解"}]},{"ID":"20240929142026-zqxtvgh","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240929142026-zqxtvgh","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"JVM 运行时的数据区域"}]},{"ID":"20240929142055-ndcbaeb","Type":"NodeParagraph","Properties":{"id":"20240929142055-ndcbaeb","updated":"20240929142104"},"Children":[{"Type":"NodeText","Data":"首先获取一个直观的认识："}]},{"ID":"20240929142121-569jv5t","Type":"NodeParagraph","Properties":{"id":"20240929142121-569jv5t","updated":"20240929142703"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 67vw;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"JVM运行时的数据区域"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240929142121-wyirm7x.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"JVM运行时的数据区域"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 67vw;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240929142238-z0oq05x","Type":"NodeParagraph","Properties":{"id":"20240929142238-z0oq05x","updated":"20240929142242"},"Children":[{"Type":"NodeText","Data":"总共也就这么 5 个区（直接内存不属于 JVM 运行时数据区的一部分），除了程序计数器其他的地方都有可能出现 OOM (OutOfMemoryError)，其中像是程序计数器和两个栈（Java 虚拟机栈 \u0026 本地方法栈）都是每个线程要有一个的，所以肯定是线程隔离的。而其他 2 个区就是线程共享的了，也就是说，如果有多个线程要同时访问这两个区的数据，是会出现线程安全问题的。接下来，我们将对这些区域进行详细的介绍。"}]},{"ID":"20240929142325-0q1f2ff","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142325-0q1f2ff","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"程序计数器"}]},{"ID":"20240929142354-asce7jy","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142354-asce7jy","updated":"20240929142354"},"Children":[{"ID":"20240929142354-7r2038s","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142354-7r2038s","updated":"20240929142354"},"Children":[{"ID":"20240929142354-hh21fjw","Type":"NodeParagraph","Properties":{"id":"20240929142354-hh21fjw","updated":"20240929142354"},"Children":[{"Type":"NodeText","Data":"当前线程所执行的字节码的行号指示器，字节码解释器工作时就是通过改变这个计数器的值来确定下一条要执行的字节码指令的位置"}]}]},{"ID":"20240929142354-iv0hslo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142354-iv0hslo","updated":"20240929142354"},"Children":[{"ID":"20240929142354-c2uvv29","Type":"NodeParagraph","Properties":{"id":"20240929142354-c2uvv29","updated":"20240929142354"},"Children":[{"Type":"NodeText","Data":"执行 Java 方法和 native 方法时的区别："}]},{"ID":"20240929142354-urkdgxn","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142354-urkdgxn","updated":"20240929142354"},"Children":[{"ID":"20240929142354-12vnv9h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142354-12vnv9h","updated":"20240929142354"},"Children":[{"ID":"20240929142354-9zvpv9e","Type":"NodeParagraph","Properties":{"id":"20240929142354-9zvpv9e","updated":"20240929142354"},"Children":[{"Type":"NodeText","Data":"执行 Java 方法时：记录虚拟机正在执行的字节码指令地址；"}]}]},{"ID":"20240929142354-dvfzxpp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142354-dvfzxpp","updated":"20240929142354"},"Children":[{"ID":"20240929142354-msw6w5v","Type":"NodeParagraph","Properties":{"id":"20240929142354-msw6w5v","updated":"20240929142354"},"Children":[{"Type":"NodeText","Data":"执行 native 方法时：无定义；"}]}]}]}]},{"ID":"20240929142354-6fz75d2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142354-6fz75d2","updated":"20240929142354"},"Children":[{"ID":"20240929142354-imwswvv","Type":"NodeParagraph","Properties":{"id":"20240929142354-imwswvv","updated":"20240929142354"},"Children":[{"Type":"NodeText","Data":"是 5 个区域中唯一不会出现 OOM 的区域。"}]}]}]},{"ID":"20240929142522-l49b23s","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-l49b23s","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java 虚拟机栈"}]},{"ID":"20240929142522-wkbt1tb","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-wkbt1tb","updated":"20240929142522"},"Children":[{"ID":"20240929142522-byoapff","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-byoapff","updated":"20240929142522"},"Children":[{"ID":"20240929142522-gx9aken","Type":"NodeParagraph","Properties":{"id":"20240929142522-gx9aken","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java 方法执行的内存模型，每个方法执行的过程，就是它所对应的栈帧在虚拟机栈中入栈到出栈的过程；"}]}]},{"ID":"20240929142522-lsslphv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-lsslphv","updated":"20240929142522"},"Children":[{"ID":"20240929142522-1iplbqh","Type":"NodeParagraph","Properties":{"id":"20240929142522-1iplbqh","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"服务于 Java 方法；"}]}]},{"ID":"20240929142522-ag8lbes","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-ag8lbes","updated":"20240929142522"},"Children":[{"ID":"20240929142522-hs5zxg1","Type":"NodeParagraph","Properties":{"id":"20240929142522-hs5zxg1","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"可能抛出的异常："}]},{"ID":"20240929142522-54zsj0m","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-54zsj0m","updated":"20240929142522"},"Children":[{"ID":"20240929142522-dpbah14","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-dpbah14","updated":"20240929142522"},"Children":[{"ID":"20240929142522-5lb1tby","Type":"NodeParagraph","Properties":{"id":"20240929142522-5lb1tby","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"OutOfMemoryError（在虚拟机栈可以动态扩展的情况下，扩展时无法申请到足够的内存）；"}]}]},{"ID":"20240929142522-g6b10g2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-g6b10g2","updated":"20240929142522"},"Children":[{"ID":"20240929142522-av9xyzg","Type":"NodeParagraph","Properties":{"id":"20240929142522-av9xyzg","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"StackOverflowError（线程请求的栈深度 \u003e 虚拟机所允许的深度）；"}]}]}]}]},{"ID":"20240929142522-e7n1b3i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-e7n1b3i","updated":"20240929142522"},"Children":[{"ID":"20240929142522-zmfaw14","Type":"NodeParagraph","Properties":{"id":"20240929142522-zmfaw14","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"虚拟机参数设置："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xss"},{"Type":"NodeText","Data":"​."}]}]}]},{"ID":"20240929142522-f7n1awd","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-f7n1awd","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"本地方法栈"}]},{"ID":"20240929142522-mdszhmt","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-mdszhmt","updated":"20240929142522"},"Children":[{"ID":"20240929142522-jf9mcny","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-jf9mcny","updated":"20240929142522"},"Children":[{"ID":"20240929142522-uwufiwd","Type":"NodeParagraph","Properties":{"id":"20240929142522-uwufiwd","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"服务于 native 方法；"}]}]},{"ID":"20240929142522-m1gutca","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-m1gutca","updated":"20240929142522"},"Children":[{"ID":"20240929142522-gweowa1","Type":"NodeParagraph","Properties":{"id":"20240929142522-gweowa1","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"可能抛出的异常：与 Java 虚拟机栈一样。"}]}]}]},{"ID":"20240929142522-c7a5o8l","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-c7a5o8l","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java 堆"}]},{"ID":"20240929142522-vpg8drt","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-vpg8drt","updated":"20240929142522"},"Children":[{"ID":"20240929142522-xneswi0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-xneswi0","updated":"20240929142522"},"Children":[{"ID":"20240929142522-hzsxja7","Type":"NodeParagraph","Properties":{"id":"20240929142522-hzsxja7","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"唯一的目的：存放对象实例；"}]}]},{"ID":"20240929142522-jb00jsp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-jb00jsp","updated":"20240929142522"},"Children":[{"ID":"20240929142522-xc83cn2","Type":"NodeParagraph","Properties":{"id":"20240929142522-xc83cn2","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"垃圾收集器管理的主要区域；"}]}]},{"ID":"20240929142522-r9d6dxi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-r9d6dxi","updated":"20240929142522"},"Children":[{"ID":"20240929142522-1hb55hr","Type":"NodeParagraph","Properties":{"id":"20240929142522-1hb55hr","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"可以处于物理上不连续的内存空间中；"}]}]},{"ID":"20240929142522-xjlnko6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-xjlnko6","updated":"20240929142522"},"Children":[{"ID":"20240929142522-zvg3b05","Type":"NodeParagraph","Properties":{"id":"20240929142522-zvg3b05","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"可能抛出的异常："}]},{"ID":"20240929142522-oxhcy14","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-oxhcy14","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ul31hsj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-ul31hsj","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ku87x1f","Type":"NodeParagraph","Properties":{"id":"20240929142522-ku87x1f","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"OutOfMemoryError（堆中没有内存可以分配给新创建的实例，并且堆也无法再继续扩展了）。"}]}]}]}]},{"ID":"20240929142522-h7rpbd6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-h7rpbd6","updated":"20240929142522"},"Children":[{"ID":"20240929142522-suwh0w6","Type":"NodeParagraph","Properties":{"id":"20240929142522-suwh0w6","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"虚拟机参数设置："}]},{"ID":"20240929142522-q4pxnbe","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-q4pxnbe","updated":"20240929142522"},"Children":[{"ID":"20240929142522-clxv3fi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-clxv3fi","updated":"20240929142522"},"Children":[{"ID":"20240929142522-yqi3tcm","Type":"NodeParagraph","Properties":{"id":"20240929142522-yqi3tcm","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"最大值："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xmx"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240929142522-suu5vvu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-suu5vvu","updated":"20240929142522"},"Children":[{"ID":"20240929142522-yv9qi27","Type":"NodeParagraph","Properties":{"id":"20240929142522-yv9qi27","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"最小值："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xms"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240929142522-6d2xd0k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-6d2xd0k","updated":"20240929142522"},"Children":[{"ID":"20240929142522-772t5fm","Type":"NodeParagraph","Properties":{"id":"20240929142522-772t5fm","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"两个参数设置成相同的值可避免堆自动扩展。"}]}]}]}]}]},{"ID":"20240929142522-2viwb0e","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-2viwb0e","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"方法区"}]},{"ID":"20240929142522-0o2mbwn","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-0o2mbwn","updated":"20240929142522"},"Children":[{"ID":"20240929142522-4qz52zh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-4qz52zh","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ihap4iv","Type":"NodeParagraph","Properties":{"id":"20240929142522-ihap4iv","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据；"}]},{"ID":"20240929142522-eghe1tv","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-eghe1tv","updated":"20240929142522"},"Children":[{"ID":"20240929142522-pjanhwy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-pjanhwy","updated":"20240929142522"},"Children":[{"ID":"20240929142522-r0ffwpa","Type":"NodeParagraph","Properties":{"id":"20240929142522-r0ffwpa","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"类信息：即 Class 类，如类名、访问修饰符、常量池、字段描述、方法描述等。"}]}]}]}]},{"ID":"20240929142522-30x6ohl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-30x6ohl","updated":"20240929142522"},"Children":[{"ID":"20240929142522-auewsq5","Type":"NodeParagraph","Properties":{"id":"20240929142522-auewsq5","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"垃圾收集行为在此区域很少发生；"}]},{"ID":"20240929142522-8m8rv87","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-8m8rv87","updated":"20240929142522"},"Children":[{"ID":"20240929142522-zgpwb0i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-zgpwb0i","updated":"20240929142522"},"Children":[{"ID":"20240929142522-1kt57s6","Type":"NodeParagraph","Properties":{"id":"20240929142522-1kt57s6","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"不过也不能不清理，对于经常动态生成大量 Class 的应用，如 Spring 等，需要特别注意类的回收状况。"}]}]}]}]},{"ID":"20240929142522-d0d06pu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-d0d06pu","updated":"20240929142522"},"Children":[{"ID":"20240929142522-zabk5cf","Type":"NodeParagraph","Properties":{"id":"20240929142522-zabk5cf","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"运行时常量池也是方法区的一部分；"}]},{"ID":"20240929142522-w1gwhva","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-w1gwhva","updated":"20240929142522"},"Children":[{"ID":"20240929142522-m5pxpb7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-m5pxpb7","updated":"20240929142522"},"Children":[{"ID":"20240929142522-hucmybg","Type":"NodeParagraph","Properties":{"id":"20240929142522-hucmybg","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项是常量池，用于存放编译器生成的各种字面量（就是代码中定义的 static final 常量）和符号引用，这部分信息就存储在运行时常量池中。"}]}]}]}]},{"ID":"20240929142522-0wrn6v3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-0wrn6v3","updated":"20240929142522"},"Children":[{"ID":"20240929142522-eb4zm6w","Type":"NodeParagraph","Properties":{"id":"20240929142522-eb4zm6w","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"可能抛出的异常："}]},{"ID":"20240929142522-wureq88","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-wureq88","updated":"20240929142522"},"Children":[{"ID":"20240929142522-64yhetv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-64yhetv","updated":"20240929142522"},"Children":[{"ID":"20240929142522-74td2o3","Type":"NodeParagraph","Properties":{"id":"20240929142522-74td2o3","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"OutOfMemoryError（方法区无法满足内存分配需求时）。"}]}]}]}]}]},{"ID":"20240929142522-5sisbb3","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-5sisbb3","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"直接内存"}]},{"ID":"20240929142522-4i3gtcn","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-4i3gtcn","updated":"20240929142522"},"Children":[{"ID":"20240929142522-bm8ar95","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-bm8ar95","updated":"20240929142522"},"Children":[{"ID":"20240929142522-lurmb30","Type":"NodeParagraph","Properties":{"id":"20240929142522-lurmb30","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"JDK 1.4 的 NIO 类可以使用 native 函数库直接分配堆外内存，这是一种基于通道与缓冲区的 I/O 方式，它在 Java 堆中存储一个 DirectByteBuffer 对象作为堆外内存的引用，这样就可以对堆外内存进行操作了。因为可以避免 Java 堆和 Native 堆之间来回复制数据，在一些场景可以带来显著的性能提高。"}]}]},{"ID":"20240929142522-we9c2z0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-we9c2z0","updated":"20240929142522"},"Children":[{"ID":"20240929142522-avpp8ke","Type":"NodeParagraph","Properties":{"id":"20240929142522-avpp8ke","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"虚拟机参数设置："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-XX:MaxDirectMemorySize"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240929142522-qm119q4","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-qm119q4","updated":"20240929142522"},"Children":[{"ID":"20240929142522-fwe4b9z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-fwe4b9z","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ws008td","Type":"NodeParagraph","Properties":{"id":"20240929142522-ws008td","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"默认等于 Java 堆最大值，即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xmx"},{"Type":"NodeText","Data":"​ 指定的值。"}]}]}]}]},{"ID":"20240929142522-pla931s","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-pla931s","updated":"20240929142522"},"Children":[{"ID":"20240929142522-tstkn26","Type":"NodeParagraph","Properties":{"id":"20240929142522-tstkn26","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"将直接内存放在这里讲解的原因是它也可能会出现 OutOfMemoryError；"}]},{"ID":"20240929142522-afpo99i","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-afpo99i","updated":"20240929142522"},"Children":[{"ID":"20240929142522-043qi3m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-043qi3m","updated":"20240929142522"},"Children":[{"ID":"20240929142522-xn5lmc2","Type":"NodeParagraph","Properties":{"id":"20240929142522-xn5lmc2","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"服务器管理员在配置 JVM 参数时，会根据机器的实际内存设置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xmx"},{"Type":"NodeText","Data":"​ 等信息，但经常会忽略直接内存（默认等于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-Xmx"},{"Type":"NodeText","Data":"​ 设置值），这可能会使得各个内存区域的总和大于物理内存限制，从而导致动态扩展时出现 OOM。"}]}]}]}]}]},{"ID":"20240929142522-36015b0","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240929142522-36015b0","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"HotSpot 虚拟机堆中的对象"}]},{"ID":"20240929142522-9yv67po","Type":"NodeParagraph","Properties":{"id":"20240929142522-9yv67po","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"这一小节将对 JVM 对 Java 堆中的对象的创建、布局和访问的全过程进行讲解。"}]},{"ID":"20240929142522-ckuqanb","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-ckuqanb","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"对象的创建（遇到一条 new 指令时）"}]},{"ID":"20240929142522-guv5p32","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240929142522-guv5p32","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ubvtpns","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240929142522-ubvtpns","updated":"20240929142522"},"Children":[{"ID":"20240929142522-l08xl0z","Type":"NodeParagraph","Properties":{"id":"20240929142522-l08xl0z","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"检查这个指令的参数能否在常量池中定位到一个类的符号引用，并检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，先把这个类加载进内存；"}]}]},{"ID":"20240929142522-wa41nxa","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240929142522-wa41nxa","updated":"20240929142522"},"Children":[{"ID":"20240929142522-4c7lvex","Type":"NodeParagraph","Properties":{"id":"20240929142522-4c7lvex","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"类加载检查通过后，虚拟机将为新对象分配内存，此时已经可以确定存储这个对象所需的内存大小；"}]}]},{"ID":"20240929142522-pmfpdeg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240929142522-pmfpdeg","updated":"20240929142522"},"Children":[{"ID":"20240929142522-12lzwt5","Type":"NodeParagraph","Properties":{"id":"20240929142522-12lzwt5","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"在堆中为新对象分配可用内存；"}]}]},{"ID":"20240929142522-budda5l","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240929142522-budda5l","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ibo6ent","Type":"NodeParagraph","Properties":{"id":"20240929142522-ibo6ent","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"将分配到的内存初始化；"}]}]},{"ID":"20240929142522-axkki9k","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20240929142522-axkki9k","updated":"20240929142522"},"Children":[{"ID":"20240929142522-4pijhrg","Type":"NodeParagraph","Properties":{"id":"20240929142522-4pijhrg","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"设置对象头中的数据；"}]}]},{"ID":"20240929142522-hds1nll","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20240929142522-hds1nll","updated":"20240929142522"},"Children":[{"ID":"20240929142522-he5la2w","Type":"NodeParagraph","Properties":{"id":"20240929142522-he5la2w","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"此时，从虚拟机的角度看，对象已经创建好了，但从 Java 程序的角度看，对象创建才刚刚开始，构造函数还没有执行。"}]}]}]},{"ID":"20240929142522-zu67s3z","Type":"NodeParagraph","Properties":{"id":"20240929142522-zu67s3z","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"第 3 步，在堆中为新对象分配可用内存时，会涉及到以下两个问题："}]},{"ID":"20240929142522-7d57rci","Type":"NodeParagraph","Properties":{"id":"20240929142522-7d57rci","updated":"20240929142522"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如何在堆中为新对象划分可用的内存？"}]},{"ID":"20240929142522-74yo5cg","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-74yo5cg","updated":"20240929142522"},"Children":[{"ID":"20240929142522-wf8qyqo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-wf8qyqo","updated":"20240929142522"},"Children":[{"ID":"20240929142522-jqegsem","Type":"NodeParagraph","Properties":{"id":"20240929142522-jqegsem","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"指针碰撞（内存分配规整）"}]},{"ID":"20240929142522-93ntjxj","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-93ntjxj","updated":"20240929142522"},"Children":[{"ID":"20240929142522-h9vxstr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-h9vxstr","updated":"20240929142522"},"Children":[{"ID":"20240929142522-d25yrhm","Type":"NodeParagraph","Properties":{"id":"20240929142522-d25yrhm","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"用过的内存放一边，没用过的内存放一边，中间用一个指针分隔；"}]}]},{"ID":"20240929142522-z2qseux","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-z2qseux","updated":"20240929142522"},"Children":[{"ID":"20240929142522-myz73g2","Type":"NodeParagraph","Properties":{"id":"20240929142522-myz73g2","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"分配内存的过程就是将指针向没用过的内存那边移动所需的长度；"}]}]}]}]},{"ID":"20240929142522-4b0yj7a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-4b0yj7a","updated":"20240929142522"},"Children":[{"ID":"20240929142522-byq1lk6","Type":"NodeParagraph","Properties":{"id":"20240929142522-byq1lk6","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"空闲列表（内存分配不规整）"}]},{"ID":"20240929142522-hpn1gpa","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-hpn1gpa","updated":"20240929142522"},"Children":[{"ID":"20240929142522-q3n57ax","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-q3n57ax","updated":"20240929142522"},"Children":[{"ID":"20240929142522-fkgeyjo","Type":"NodeParagraph","Properties":{"id":"20240929142522-fkgeyjo","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"维护一个列表，记录哪些内存块是可用的；"}]}]},{"ID":"20240929142522-7nc0gcx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-7nc0gcx","updated":"20240929142522"},"Children":[{"ID":"20240929142522-8zjzzl4","Type":"NodeParagraph","Properties":{"id":"20240929142522-8zjzzl4","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"分配内存时，从列表上选取一块足够大的空间分给对象，并更新列表上的记录；"}]}]}]}]}]},{"ID":"20240929142522-4psdf4y","Type":"NodeParagraph","Properties":{"id":"20240929142522-4psdf4y","updated":"20240929142522"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如何处理多线程创建对象时，划分内存的指针的同步问题？"}]},{"ID":"20240929142522-acfuibd","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-acfuibd","updated":"20240929142522"},"Children":[{"ID":"20240929142522-xhx0kc8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-xhx0kc8","updated":"20240929142522"},"Children":[{"ID":"20240929142522-z1ymmn7","Type":"NodeParagraph","Properties":{"id":"20240929142522-z1ymmn7","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"对分配内存空间的动作进行同步处理（CAS）；"}]}]},{"ID":"20240929142522-3ngovqf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-3ngovqf","updated":"20240929142522"},"Children":[{"ID":"20240929142522-5y1ilii","Type":"NodeParagraph","Properties":{"id":"20240929142522-5y1ilii","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"把内存分配动作按照线程划分在不同的空间之中进行；"}]},{"ID":"20240929142522-i2vj8af","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-i2vj8af","updated":"20240929142522"},"Children":[{"ID":"20240929142522-zwfapg1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-zwfapg1","updated":"20240929142522"},"Children":[{"ID":"20240929142522-ywosacx","Type":"NodeParagraph","Properties":{"id":"20240929142522-ywosacx","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"每个线程在 Java 堆中预先分配一小块内存，称为本地线程分配缓冲（Thread Local Allocation Buffer，TLAB）；"}]}]},{"ID":"20240929142522-9yrc606","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-9yrc606","updated":"20240929142522"},"Children":[{"ID":"20240929142522-d4c8g93","Type":"NodeParagraph","Properties":{"id":"20240929142522-d4c8g93","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"哪个线程要分配内存就在哪个线程的 TLAB 上分配，TLAB 用完需要分配新的 TLAB 时，才需要同步锁定；"}]}]},{"ID":"20240929142522-ar822jo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-ar822jo","updated":"20240929142522"},"Children":[{"ID":"20240929142522-0lhg41m","Type":"NodeParagraph","Properties":{"id":"20240929142522-0lhg41m","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-XX:+/-UseTLAB"},{"Type":"NodeText","Data":"​ 参数设定是否使用 TLAB。"}]}]}]}]}]},{"ID":"20240929142522-uju9okl","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-uju9okl","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"对象的内存布局"}]},{"ID":"20240929142522-1ii578z","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-1ii578z","updated":"20240929142522"},"Children":[{"ID":"20240929142522-j3a1gr2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-j3a1gr2","updated":"20240929142522"},"Children":[{"ID":"20240929142522-f7a8um6","Type":"NodeParagraph","Properties":{"id":"20240929142522-f7a8um6","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"对象头："}]},{"ID":"20240929142522-ejhnit0","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-ejhnit0","updated":"20240929142522"},"Children":[{"ID":"20240929142522-5b5ztnq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-5b5ztnq","updated":"20240929142522"},"Children":[{"ID":"20240929142522-clehbou","Type":"NodeParagraph","Properties":{"id":"20240929142522-clehbou","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"第一部分：存储对象自身运行时的数据，HashCode、GC分代年龄等（Mark Word）；"}]}]},{"ID":"20240929142522-76lj02u","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-76lj02u","updated":"20240929142522"},"Children":[{"ID":"20240929142522-11nmjzx","Type":"NodeParagraph","Properties":{"id":"20240929142522-11nmjzx","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"第二部分：类型指针，指向它的类元数据的指针，虚拟机通过这个指针来判断这个对象是哪个类的实例（HotSpot 采用的是直接指针的方式访问对象的）；"}]}]},{"ID":"20240929142522-kcmyzah","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-kcmyzah","updated":"20240929142522"},"Children":[{"ID":"20240929142522-cz6ih07","Type":"NodeParagraph","Properties":{"id":"20240929142522-cz6ih07","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"如果是个数组对象，对象头中还有一块用于记录数组长度的数据。"}]}]}]}]},{"ID":"20240929142522-133pxgb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-133pxgb","updated":"20240929142522"},"Children":[{"ID":"20240929142522-2nxqoae","Type":"NodeParagraph","Properties":{"id":"20240929142522-2nxqoae","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"实例数据："}]},{"ID":"20240929142522-55hpg0c","Type":"NodeList","ListData":{},"Properties":{"id":"20240929142522-55hpg0c","updated":"20240929142522"},"Children":[{"ID":"20240929142522-k9wzzlx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-k9wzzlx","updated":"20240929142522"},"Children":[{"ID":"20240929142522-xoxe5ed","Type":"NodeParagraph","Properties":{"id":"20240929142522-xoxe5ed","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"默认分配顺序：longs/doubles、ints、shorts/chars、bytes/booleans、oops (Ordinary Object Pointers)，相同宽度的字段会被分配在一起，除了 oops，其他的长度由长到短；"}]}]},{"ID":"20240929142522-y9l9fe4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240929142522-y9l9fe4","updated":"20240929142522"},"Children":[{"ID":"20240929142522-4qr1ni3","Type":"NodeParagraph","Properties":{"id":"20240929142522-4qr1ni3","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"默认分配顺序下，父类字段会被分配在子类字段前面。"}]}]}]}]}]},{"ID":"20240929142522-pzmq0hx","Type":"NodeParagraph","Properties":{"id":"20240929142522-pzmq0hx","updated":"20240929142522"},"Children":[{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"注：HotSpot VM要求对象的起始地址必须是8字节的整数倍，所以不够要补齐。"}]},{"ID":"20240929142522-sbbnxut","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240929142522-sbbnxut","updated":"20240929142620"},"Children":[{"Type":"NodeText","Data":"对象的访问"}]},{"ID":"20240929142522-skirhec","Type":"NodeParagraph","Properties":{"id":"20240929142522-skirhec","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"Java 程序需要通过虚拟机栈上的 reference 数据来操作堆上的具体对象，reference 数据是一个指向对象的引用，不过如何通过这个引用定位到具体的对象，目前主要有以下两种访问方式：句柄访问和直接指针访问。"}]},{"ID":"20240929142522-qjy4xvr","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20240929142522-qjy4xvr","updated":"20240929142620"},"Children":[{"Type":"NodeText","Data":"句柄访问"}]},{"ID":"20240929142522-mk6mzuz","Type":"NodeParagraph","Properties":{"id":"20240929142522-mk6mzuz","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"句柄访问会在 Java 堆中划分一块内存作为句柄池，每一个句柄存放着到对象实例数据和对象类型数据的指针。"}]},{"ID":"20240929142522-hp9ojih","Type":"NodeParagraph","Properties":{"id":"20240929142522-hp9ojih","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"优势：对象移动的时候（这在垃圾回收时十分常见）只需改变句柄池中对象实例数据的指针，不需要修改reference本身。"}]},{"ID":"20240929142550-prbsq0u","Type":"NodeParagraph","Properties":{"id":"20240929142550-prbsq0u","updated":"20240929142620"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"height: 67vh;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"对象的访问定位_句柄访问"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240929142550-o9cu8mr.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"对象的访问定位_句柄访问"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"height: 67vh;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240929142522-yxy503j","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20240929142522-yxy503j","updated":"20240929142657"},"Children":[{"Type":"NodeText","Data":"直接指针访问"}]},{"ID":"20240929142522-0jddu3j","Type":"NodeParagraph","Properties":{"id":"20240929142522-0jddu3j","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"直接指针访问方式在 Java 堆对象的实例数据中存放了一个指向对象类型数据的指针，在 HotSpot 中，这个指针会被存放在对象头中。"}]},{"ID":"20240929142522-jguavp1","Type":"NodeParagraph","Properties":{"id":"20240929142522-jguavp1","updated":"20240929142522"},"Children":[{"Type":"NodeText","Data":"优势：减少了一次指针定位对象实例数据的开销，速度更快。"}]},{"ID":"20240929142644-zx6ukl5","Type":"NodeParagraph","Properties":{"id":"20240929142644-zx6ukl5","updated":"20240929142657"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 67vw;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"对象的访问定位_直接指针访问"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240929142644-rcchwlr.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"对象的访问定位_直接指针访问"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 67vw;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240929141501-l07qaby","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240929141501-l07qaby","updated":"20240929141509"},"Children":[{"Type":"NodeText","Data":"垃圾收集器与内存分配策略"}]},{"ID":"20240929141512-ta8225r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240929141512-ta8225r","updated":"20240929141513"},"Children":[{"Type":"NodeText","Data":"虚拟机性能监控、故障处理工具"}]},{"ID":"20240929141516-ojato6b","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240929141516-ojato6b","updated":"20240929141516"},"Children":[{"Type":"NodeText","Data":"调优案例分析与实战"}]}]}